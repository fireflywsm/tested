<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Essential Studio for JavaScript : Gantt</title>
    <link href="css/ej.widgets.core.min.css" rel="stylesheet" />
    <link href="css/ej.theme.min.css" rel="stylesheet" />

    <!--[if lt IE 9]>
    <script src="../../scripts/jquery-1.11.3.min.js"></script> 
    <![endif]-->
    <!--[if IE 9]><!-->
    <script src="Scripts/jquery-3.1.1.min.js"> </script>
    <!--<![endif]-->

    <script src="Scripts/jsrender.min.js"></script>
    <script src="Scripts/ej.web.all.min.js"></script>

    <!--测试数据 -->
    <script src="Scripts/hustProjectData.js"></script>
    <!--中文支持-->
    <script src="Scripts/i18n/ej.culture.zh-CN.min.js"></script>
    <script src="Scripts/i18n/ej.localetexts.zh-CN.min.js"></script>

    <style>
        body, html {
            margin: 0px;
            padding: 0px;
            
        }

    </style>
</head>
<body>

    <div id="gantt" ></div>
    <button value="updateGanttSize" id="updateGanttSize" onclick="updateGanttSize();">updateGanttSize</button>
    <!--<button value="Export" id="export">Export</button> -->
    <script type="text/javascript">

        $(function () {
            $("#gantt").ejGantt({
                dataSource: projectData,
                locale: "zh-CN",
                allowColumnResize: true,
                enableResize: true,
                taskIdMapping: "taskID",
                taskNameMapping: "taskName",
                startDateMapping: "startDate",
                progressMapping: "progress",
                durationMapping: "duration",
                endDateMapping: "endDate",
                childMapping: "subtasks",
                // baselineStartDateMapping: "baselineStartDate",
                // baselineEndDateMapping: "baselineEndDate",
                enableVirtualization: true,
                enablePredecessorValidation: true,
                highlightWeekends: true,
                scheduleStartDate: "05/05/2017",
                scheduleEndDate: "07/09/2017",
                includeWeekend: true,
                predecessorMapping: "predecessor",
                readOnly: false,
                allowDragAndDrop: true,

                scheduleHeaderSettings: {

                    weekendBackground : "#F2F2F2",

                },

                editSettings: {
                    allowEditing: true,
                    allowAdding: true,
                    allowDeleting: true,
                    editMode: "cellEditing",
                    allowIndent: true
                },

                queryCellInfo: function (args) {
                    $(args.cellElement).css({ "text-align":"left" });
                },

                load: function (args) {                   
                    var columns = this.getColumns();
                    for (var i = 0; i < columns.length; i++) {
                        console.log(columns[i].field);
                        if (columns[i].field == "taskName") {
                            columns[i].width = 230;
                        }else if(columns[i].field == "taskId"){
                            columns[i].width = 50;
                        }else{
                            columns[i].width = 100;
                        }
                    }

                },

                sizeSettings: {
                    width: "100%",
                    height: "700px"
                },

                showGridCellTooltip: true,
                treeColumnIndex: 1,
                allowDragAndDrop: true,
                firstDayOfWeek: "0"

            });


            $("#gantt").ejGantt({
                toolbarSettings: {
                    showToolbar: true,
                    toolbarItems: [
                        ej.Gantt.ToolbarItems.Add,
                        ej.Gantt.ToolbarItems.Edit,
                        ej.Gantt.ToolbarItems.Delete,
                        ej.Gantt.ToolbarItems.Indent,
                        ej.Gantt.ToolbarItems.Outdent,
                        ej.Gantt.ToolbarItems.Search
                    ],
                }
            });


        });

            function updateGanttSize() {
                var ganttObj = $("#gantt").ejGantt("instance"),
                toolbarHeight = $("#gantt_toolbarItems").outerHeight(),
                model = ganttObj.model, width, totalLen = 0,
                treeObj = ganttObj._$treegridHelper.ejTreeGrid("instance");            
                
                var treeWidth = $("#ejTreeGrid" + ganttObj._id + "e-table").outerWidth() + 1,
                    chartWidth = $("#ganttviewerbodyContentejGanttChart" + ganttObj._id).outerWidth() + 2;

                totalLen = treeObj.getExpandedRecords(model.updatedRecords);
                //To calculate the height of Gantt as per records count
                var height = model.rowHeight * (totalLen.length+1) + treeObj.getHeaderContent().height() + toolbarHeight,           
                    width = treeWidth + chartWidth + 9;
                //Resizing Gantt and update splitter bar position
                var sizesettings = { height: height.toString(), width: width.toString() },
                    splitterSettings = { position: treeWidth.toString() };
                ganttObj.setModel({ "sizeSettings": sizesettings, "splitterSettings":splitterSettings });
            }

    </script>

</body>
</html>
